resources:
- "@type": type.googleapis.com/envoy.api.v2.Listener
  name: ingress
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 8000

  filter_chains:
  - filters:
    - name: envoy.http_connection_manager
      config:
        stat_prefix: ingress_http
        route_config:
          virtual_hosts:
          - name: backend
            domains: ["*"]
            routes:
            - match:
                prefix: "/"
              route:
                cluster: google
        http_filters:
        - name: envoy.ext_authz
          config:
            http_service:
              authorization_request:
                allowed_headers:
                  patterns:
                    - exact: "cookie"
              server_uri:
                uri: "http://auth2"
                cluster: auth2
                timeout: 2s
        - name: envoy.router
          config: {}
